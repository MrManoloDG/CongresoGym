<!DOCTYPE html>
<html lang="es" dir="ltr">
	<head>
		<title>AdminPanel, Congreso Gym</title>
		<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="keywords" content="Congreso, gimnasia">
    <meta name="description" content="Congreso de Gimania realizado del dia 09-11-2018 a 11-11-2018">
    <meta name="subject" content="Congreso Gimnasia">
    <meta name="author" content="Manuel, manuel.diazgil@alum.uca.es - Daniel, daniel.mejiasramirez@alum.uca.es">
		<link rel="shortcut icon" href="img/logo.png">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<script src="https://unpkg.com/ionicons@4.4.6/dist/ionicons.js"></script>
		<script src = "https://unpkg.com/sweetalert/dist/sweetalert.min.js"> </script>
	<script src="js/ajax.js"></script>
		<link href="css/style.css" rel="stylesheet">

		<link rel="stylesheet" href="recursos/leaflet/leaflet.css" />
		<script src="recursos/leaflet/leaflet.js"></script>


	</head>
	<body>
    <body>
    	  <header class="header">
    			<nav class="navbar navbar-expand-lg navbar-dark bg-negro">
    			    <a class="navbar-brand" href="index.html"><img height="50" src="img/logo.png" alt="">Congreso Gimnasia</a>
    			    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
    			      <span class="navbar-toggler-icon"></span>
    			    </button>
    			    <div class="collapse navbar-collapse" id="navbarText">
    			      <ul class="navbar-nav ml-auto">
    			        <li class="nav-item">
    			          <a class="nav-link" href="programa.html">Programa</a>
    			        </li>
    			        <li class="nav-item">
    			          <a class="nav-link" href="localizacion.html">Localización</a>
    			        </li>
    			        <li class="nav-item">
    			          <a class="nav-link" href="inscripcion.html">Inscripción</a>
    			        </li>
    			      </ul>
    			    </div>
    		  </nav>
    	  </header>
    	  <main>
    			<div class="container-fluid sectionGradient" id="main">
    			  <div class="row">
    					<section class="col-xs-12 col-md-7  p-3">
                <h2>Usuarios  <a class="p-0" href="javascript:void(0)" id="NewUser"><ion-icon name="add" style=" font-size: 30px;"></ion-icon></a></h2>
                <hr>
                <div style="height:400px; overflow-y: scroll;">
                    <table class="table table-sm table-striped table-principal">
                      <thead class="thead-dark">
                          <tr class='editarUsu'>
                            <th class="text-center">Nombre</th>
														<th class="text-center">Plan</th>
                            <th class="text-center">Fecha inicio</th>
                            <th class="text-center">Fecha final</th>
														<th class="text-center">Observaciones</th>
                            <th class="text-center">telefono</th>
                            <th class="text-center">Email</th>

                          </tr>
                        </thead>
                            <tbody class="body" id="body">
                              <tr>
                              </tr>
                        </tbody>
                      </table>
                  </div>
    					</section>
    					<section class="d-none col-xs-12 col-md-5  p-3" id="editarUsuario">
                <div id="formulario">
                  <h2 id="titulo"> Editar/Crear</h2>
                  <hr>
                  <form class="m-auto px-5" action="#" method="post" id="id_form" onsubmit="return validar();">
                    <div class="p-0  pr-2 pt-2 m-0 row col-md-12">
                        <div class="col-md-4"><label for="name">Nombre:</label></div>
                        <div class="p-0 pr-4 col-md-8"><input class="w-100 form-control" type="text" id="name" name="name" placeholder="Nombre"></div>
                    </div>
										<input type="hidden" value="" id="opcion">
                    <div class="p-0  pr-2 pt-2 m-0 row col-md-12">
                        <div class="col-md-4"><label for="name">Plan:</label></div>
                        <div class="p-0 pr-4 col-md-8">
                          <select name="tipo" class="form-control" id="plan">
                                  <option value="0">Plan free(0 euros)</option>
                                  <option value="50">Plan parcial(50 euros)</option>
                                  <option value="100">Plan completo(100 euros)</option>
                          </select>
                        </div>
                    </div>
                    <div class="p-0  pr-2 pt-2 m-0 row col-md-12">
                        <div class="col-md-4"><label>Fecha Llegada y Salida:</label></div>
                        <div class="p-0 pr-4 col-md-4"><input class="w-100 form-control" type="date" id="fechaini" name="fechaini" value="2018-11-09"></div>
                        <div class="p-0 pr-4 col-md-4"><input class="w-100 form-control" type="date" id="fechafin" name="fechafin" value="2018-11-11"></div>
                    </div>
                    <div class="p-0  pr-2 pt-2 m-0 row col-md-12">
                        <div class="col-md-4"><label for="telf">Telefono:</label></div>
                        <div class="p-0 pr-4 col-md-8"><input class="w-100 form-control" type="text" id="telf" name="telf" placeholder="Telefono 8 digitos"></div>
                    </div>
                    <div class="p-0 pr-2 pt-2 m-0 row col-md-12">
                        <div class="col-md-4"><label for="email">E-mail:</label></div>
                        <div class="p-0 pr-4 col-md-8"><input class="w-100 form-control" type="email" id="email" name="email" placeholder="email"></div>
                    </div>
                    <div class="p-0  pr-2 pt-2 m-0 row col-md-12">
                        <div class="col-md-4"><label for="msg">Observaciones:</label></div>
                        <div class="p-0  pr-4 col-md-8"><textarea class="w-100 form-control" id="msg" name="message"></textarea></div>
                    </div>
                    <div class="row pt-2 pl-3 mx-auto">
                        <input class="btn btnOrange mx-2"  value="Guardar" id="submitActualizar">
                        <input class="btn btnOrange mx-2"  value="eliminar" id="submitEliminar">
                    </div>
                  </form>
                </div>
    					</section>
    			  </div>
						<section class="col-12 p-3" id="editarUsuario">
							<div class="col-4 mx-auto">
								<input class="btn btnOrange mx-2"  value="eliminar Todos" id="submitEliminarTodas">
							</div>
						</section>
    			</div>
    	  </main>
    		<footer class="footer">
    			<div class="col-md-12 pt-2">
    				<div class="row col-md-5 pt-4 m-auto">
    					<div class="col-md-4"> <a href="https://www.youtube.com/watch?v=FCkqV3OwuZc" target="_blank"> <ion-icon class="footerIcon hydrated" name="logo-youtube" role="img" aria-label="logo youtube"></ion-icon>  </a> </div>
    					<div class="col-md-4"> <a href="https://twitter.com/Dani_mejias96" target="_blank"> <ion-icon class="footerIcon hydrated" name="logo-twitter" role="img" aria-label="logo twitter"></ion-icon>   </a> </div>
    					<div class="col-md-4"> <a href="https://www.facebook.com/Congresotheinfluencers/" target="_blank"> <ion-icon class="footerIcon hydrated" name="logo-facebook" role="img" aria-label="logo facebook"></ion-icon> </a> </div>
    				</div>
    				<p>Nuestro Correo <a class="orangeHref" href="mailto:manolo.diazgil@alum.uca.es">manolo.diazgil@alum.uca.es</a> y nuestro telefono de contancto <a class="orangeHref" href="tel:">607129378</a></p>
    				<p>Trabajo para la asignatura de programación en internet ©</p>
    			</div>
    		</footer>
    		<script>
				obtener();

				function obtener(){
					$.ajax({
							type: "GET",
							url: "http://localhost:8080/users",
							contentType: "application/json",
							success: function(data){
								$("#body").html("");
								$.each(data, function (index, value) {
									$("#body").append("<tr class='editarUsu' data-id="+value['_id']+"><td>"+value['name']+"</td><td>"+value['plan']+"</td><td>"+value['date_start']+"</td><td>"+value['date_end']+"</td><td>"+value['comment']+"</td><td>"+value['telf']+"</td><td>"+value['email']+"</td><tr>");
										});
							},
							error:function(res){
											alert("ERROR: "+ res.statusText);  }
					});
				};

				$(document).on('click','#submitActualizar',function(){
					crearEditar($('#opcion').val());
					setTimeout(obtener(),1000);
			  });

				$(document).on('click','#submitEliminarTodas',function(){
					eliminarTodas();
					setTimeout(obtener(),1000);
			  });

				$(document).on('click','#submitEliminar',function(){
					eliminar($('#opcion').val());
					setTimeout(obtener(),1000);
					$('#editarUsuario').addClass("d-none");
				});

				$(document).on('click','#NewUser',function(){
 				 $('#editarUsuario').removeClass("d-none");
				 $('#submitEliminar').addClass("d-none");
				 $('#opcion').val("");
				 $('#titulo').html("Crear Usuario");
				 $('#name').val("");
				 $('#telf').val("");
				 $('#email').val("");
				 $('#fechafin').val("");
				 $('#fechaini').val("");
				 $('#plan').val("");
				 $('#msg').val("");
				 $('#opcion').val("");
			  });

				$(document).on('click','.editarUsu',function(){
				var id = $(this).data('id');
				console.log(id);
			  $('#editarUsuario').removeClass("d-none");
				$('#titulo').html("editar/borrar Usuario")
				$('#submitEliminar').removeClass("d-none");
			 	$.ajax({
					 type: "GET",
						 url: "http://localhost:8080/users/"+id,
						 contentType: "application/json",
						 success: function(data){
							 console.log(data);
							 $('#name').val(data[0]['name']);
							 $('#telf').val(data[0]['telf']);
							 $('#email').val(data[0]['email']);
							 $('#fechafin').val(data[0]['date_end']);
							 $('#fechaini').val(data[0]['date_start']);
							 $('#plan').val(data[0]['plan']);
							 $('#msg').val(data[0]['comment']);
							 $('#opcion').val(data[0]['_id']);

						 },
						 error:function(res){
										 alert("ERROR: "+ res.statusText);  }
				 });
			  });

        //request.open('GET', 'http://localhost:8080/users', true);


    		</script>
	</body>
</html>
